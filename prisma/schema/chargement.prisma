model Chargement {
  id         String      @id @default(uuid())
  name       String
  livraisons Livraison[]

  dateLivraison DateTime? @default(now())
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  livreurId String?
  livreur   User?   @relation(fields: [livreurId], references: [id])
  status    Status  @default(PENDING)

  history ChargementHistory[]

  // Ensure only one PENDING chargement per livreur per day
  @@unique([livreurId, status, dateLivraison], name: "unique_pending_chargement_per_day")
  @@map("chargement")
}

model ChargementHistory {
  id           String   @id @default(cuid())
  chargementId String
  action       String
  userId       String
  user         User     @relation(fields: [userId], references: [id])
  snapshot     Json // Full chargement state at time of change
  timestamp    DateTime @default(now())

  chargement Chargement @relation(fields: [chargementId], references: [id], onDelete: Cascade)

  @@map("chargementHistory")
}
