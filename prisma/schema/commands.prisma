model Commande {
  id        String   @id @default(cuid())
  ref       String
  name      String   @default("Commande")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  status    Status   @default(PENDING)

  livraisons Livraison[]
  docVente   DocVente?   @relation(fields: [docVenteId], references: [id], onDelete: Cascade)
  docVenteId String?     @unique

  // Relations
  clientId String? // Foreign key to Client model
  client   Client?           @relation(fields: [clientId], references: [id])
  history  CommandeHistory[]

  originalItems Json?

  // delivery infos
  priority            Priority  @default(UNDEFINED)
  plannedDeliveryDate DateTime? // Planned delivery date

  commentaires String? // Comments

  @@index([clientId])
  @@map("commande")
}

model CommandeHistory {
  id         String   @id @default(cuid())
  commandeId String
  userId     String
  action     String
  user       User     @relation(fields: [userId], references: [id])
  snapshot   Json // Full commande state at time of change
  timestamp  DateTime @default(now())

  commande Commande @relation(fields: [commandeId], references: [id], onDelete: Cascade)

  @@map("commandeHistory")
}
