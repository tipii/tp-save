model Commande {
  id        String   @id @default(cuid())
  ref       String
  name      String   @default("Commande")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  status    Status   @default(PENDING)

  livraisons Livraison[]

  // Relations
  clientId String? // Foreign key to Client model
  client   Client?           @relation(fields: [clientId], references: [id])
  history  CommandeHistory[]

  // Non Functional Data
  orderReceivedById    String?
  orderReceivedBy      User?     @relation("OrderReceivedBy", fields: [orderReceivedById], references: [id])
  orderTransmittedById String?
  orderTransmittedBy   User?     @relation("OrderTransmittedBy", fields: [orderTransmittedById], references: [id])
  orderReceptionMode   String?
  orderReceptionDate   DateTime?

  quote_number       String? // Quote number
  bc_number          String? @unique // Bon Commande / bpa
  bp_number          String? @unique // Bon de pr√©paration
  bl_number          String? @unique // Bon de livraison
  cf_bl_ou_rq_number String? // CF BL or RQ number
  facture_number     String? // Facture number

  bonPrepaGesco         String? // Gesco preparation slip
  docGesco              String? // Gesco document
  docGescoImp           String? // Gesco printed document
  receptionBlFactSignee String? // Reception BL or signed invoice
  commercial            String? // Sales person
  entreprises           String? // Company
  lieu                  String? // Location
  originalItems         Json?

  // delivery infos
  priority            Priority  @default(UNDEFINED)
  plannedDeliveryDate DateTime? // Planned delivery date

  commentaires String? // Comments

  @@index([clientId])
  @@map("commande")
}

model CommandeHistory {
  id         String   @id @default(cuid())
  commandeId String
  userId     String
  action     String
  user       User     @relation(fields: [userId], references: [id])
  snapshot   Json // Full commande state at time of change
  timestamp  DateTime @default(now())

  commande Commande @relation(fields: [commandeId], references: [id], onDelete: Cascade)

  @@map("commandeHistory")
}
