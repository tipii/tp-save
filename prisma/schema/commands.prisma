model Commande {
  id        String   @id @default(cuid())
  ref       String
  clientId  String? // Foreign key to Client model
  items     Int
  priority  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  status    String   @default("pending")

  chargementId String?
  chargement   Chargement? @relation(fields: [chargementId], references: [id])
  // Simple Edit Lock
  lockedBy     String? // User ID who locked it
  lockedUntil  DateTime? // Auto-unlock after timeout (e.g., 15 minutes)

  // Relations
  client  Client?           @relation(fields: [clientId], references: [id])
  history CommandeHistory[]

  @@index([clientId])
  @@map("commande")
}

model CommandeHistory {
  id         String   @id @default(cuid())
  commandeId String
  userId     String
  action     String
  user       User     @relation(fields: [userId], references: [id])
  snapshot   Json // Full commande state at time of change
  timestamp  DateTime @default(now())

  commande Commande @relation(fields: [commandeId], references: [id], onDelete: Cascade)

  @@map("commandeHistory")
}
